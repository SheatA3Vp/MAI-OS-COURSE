# Лабораторная работа №3: Межпроцессное взаимодействие с использованием общей памяти

## Постановка задачи

**Вариант 20.**

Родительский процесс создает дочерний процесс. Первой строчкой пользователь в консоль родительского процесса пишет имя файла, которое будет передано при создании дочернего процесса. Родительский и дочерний процесс должны быть представлены разными программами.

Родительский процесс передает команды пользователя дочернему процессу через shared memory. Дочерний процесс при необходимости передает данные в родительский процесс через shared memory. Результаты своей работы дочерний процесс пишет в созданный им файл. Допускается просто открыть файл и писать туда, не перенаправляя стандартный поток вывода.

Пользователь вводит команды вида: «число число число< endline >». Далее эти числа передаются от родительского процесса в дочерний. Дочерний процесс считает их сумму и выводит её в файл. Числа имеют тип float. Количество чисел может быть произвольным.

## Общий метод и алгоритм решения

В рамках лабораторной работы мы реализовали межпроцессное взаимодействие (IPC) между родительским и дочерним процессами, заменив каналы (pipes) на общую память (shared memory) и семафоры для синхронизации. Это позволило передавать данные и результаты без копирования через каналы, обеспечивая более эффективное взаимодействие. Программа читает числа из stdin, вычисляет их сумму в дочернем процессе, записывает результат в файл и выводит сумму на stdout (или ошибки на stderr).

## Как работает программа

1. **Родительский процесс**: Читает числа из stdin, отправляет их дочернему через общую память (с синхронизацией семафором). Ожидает результат, проверяет на ошибки (префикс "ERROR:") и выводит сумму на stdout или ошибку на stderr. Сигнализирует дочернему о завершении.

2. **Дочерний процесс**: Получает данные из общей памяти, парсит числа, вычисляет сумму (с проверками на переполнение, диапазон и валидность), записывает сумму в указанный файл и возвращает результат родителю через общую память.

3. **Синхронизация**: Семафор обеспечивает, что только один процесс работает с общей памятью одновременно. Общая память разделена: первые 4 байта — длина данных, остальное — данные/результат.

4. **Обработка ошибок**: Все ошибки начинаются с "ERROR:" и направляются на stderr. Программа корректно очищает ресурсы (unlink, close, munmap) перед выходом.

Это решение более эффективно, чем pipes, так как избегает копирования данных и позволяет прямой доступ к памяти.

## Запуск программы

1. Скомпилируйте программы:
   ```
   gcc -o parent parent.c
   gcc -o child child.c
   ```

2. Запустите родительский процесс:
   ```
   ./parent
   ```

3. Введите имя файла (например, `output.txt`).

4. Вводите команды в виде чисел, разделенных пробелами, например:
   ```
   1.5 2.3 3.7
   ```

5. Для завершения введите пустую строку или Ctrl+D.

Результаты будут записаны в указанный файл, а сумма выведена на экран.